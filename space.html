<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Genshin RPG</title>
<style>
body { background: #1e1e2f; color: #fff; font-family: sans-serif; margin: 0; text-align: center; }
h1 { margin-top: 10px; }
#game { max-width: 600px; margin: auto; padding: 10px; position: relative; }
#map { display: grid; grid-template-columns: repeat(5, 1fr); grid-auto-rows: 60px; gap: 4px; max-width: 320px; margin: 20px auto; }
.cell { width: 100%; height: 60px; background: #333; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 24px; transition: all 0.2s ease; }
.enemy { background: #cc2222; }
.chest { background: #996600; }
.player { outline: 3px solid cyan; }
button { margin: 5px; padding: 10px 20px; border: none; border-radius: 6px; background: #555; color: white; cursor: pointer; font-size: 16px; }
button:hover { background: #777; }
.control-btn { width: 50px; height: 50px; font-size: 24px; background: #444; border-radius: 8px; }
#controls { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
#battle { display: none; }
#battle.active { display: block; }
#map.active { display: grid; }
.attack-effect { position: absolute; font-size: 28px; animation: flash 0.3s ease forwards; }
@keyframes flash { 0% { transform: scale(1); opacity:1; } 50% { transform: scale(1.5); opacity:0.8; } 100% { transform: scale(1); opacity:0; } }
#upgradeMenu, #rewardMenu { position: fixed; top: 0; right: -250px; width: 250px; height: 100%; background: #222; padding: 0px; transition: right 0.3s ease; z-index: 10; }
#upgradeMenu.active, #rewardMenu.active { right: 0; }
#upgradeMenu h2, #rewardMenu h2 { margin-top: 0; }
#game { position: relative; }
</style>
</head>
<body>

<h1>Mini Genshin RPG</h1>
<div id="game">
  <div id="stats">
    üéÆ <span id="charName">–õ—é–º–∏–Ω (–ê–Ω–µ–º–æ)</span><br>
    üß™ –£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span> | üí• –û–ø—ã—Ç: <span id="xp">0</span><br>
    ‚ù§Ô∏è –•–ü: <span id="charHp">100</span> / 100<br>
    ‚ö° –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å: <span id="stamina">35</span> / 35<br>
    üí∞ –ú–æ–Ω–µ—Ç—ã: <span id="coins">0</span><br>
    üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å: <span id="inventory">–ü—É—Å—Ç–æ</span>
  </div>

  <button onclick="toggleUpgradeMenu()">üõ† –ü—Ä–æ–∫–∞—á–∫–∞</button>

  <div id="map" class="active"></div>

  <div id="controls">
    <button class="control-btn" onclick="move(0,-1)">‚¨Ü</button>
    <button class="control-btn" onclick="move(-1,0)">‚¨Ö</button>
    <button class="control-btn" onclick="move(1,0)">‚û°</button>
    <button class="control-btn" onclick="move(0,1)">‚¨á</button>
  </div>

  <button onclick="switchCharacter()">üîÅ –°–º–µ–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
  <div id="log">–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–µ–ª–∫–∏ –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è.</div>

  <div id="battle">
    <h2>‚öî –ë–∏—Ç–≤–∞!</h2>
    <p>üë§ –í–∞—à –•–ü: <span id="playerHp">100</span> / 100</p>
    <p>üëæ –í—Ä–∞–≥ –•–ü: <span id="enemyHp">30</span> / 30</p>
    <p>‚ö° –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å: <span id="battleStamina">35</span> / 35</p>
    <button onclick="playerTurn('attack')">üó° –ê—Ç–∞–∫–∞ (8‚ö°)</button>
    <button onclick="playerTurn('skill')">üí• –ù–∞–≤—ã–∫ (15‚ö°)</button>
  </div>

  <div id="upgradeMenu">
    <h2>üìà –ü—Ä–æ–∫–∞—á–∫–∞</h2>
    <p>–ú–æ–Ω–µ—Ç—ã: <span id="menuCoins">0</span></p>
    <button onclick="upgrade('stamina')">‚ö° –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å +5 (10üí∞)</button><br>
    <button onclick="upgrade('damage')">üó° –£—Ä–æ–Ω +2 (10üí∞)</button><br>
    <button onclick="upgrade('hp')">‚ù§Ô∏è –ú–∞–∫—Å –•–ü +20 (10üí∞)</button><br>
    <button onclick="toggleUpgradeMenu()">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <div id="rewardMenu">
    <h2>üéÅ –í—ã–±–æ—Ä –Ω–∞–≥—Ä–∞–¥—ã</h2>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É –∑–∞ –∑–∞—á–∏—Å—Ç–∫—É –∫–∞—Ä—Ç—ã:</p>
    <button onclick="chooseReward('hp')">‚ù§Ô∏è +20 –•–ü</button><br>
    <button onclick="chooseReward('damage')">üó° +2 –£—Ä–æ–Ω</button><br>
    <button onclick="chooseReward('stamina')">‚ö° +5 –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å</button><br>
  </div>
</div>

<script>
const characters = [
  { name: "–õ—é–º–∏–Ω (–ê–Ω–µ–º–æ)", element: "anemo", level: 1, xp: 0, hp: 100, hpMax:100, emoji: "üå™Ô∏è", maxStamina:35, damage:10 },
  { name: "–î–∏–ª—é–∫ (–ü–∏—Ä–æ)", element: "pyro", level: 1, xp: 0, hp: 100, hpMax:100, emoji: "üî•", maxStamina:35, damage:12 },
  { name: "–ë–∞—Ä–±–∞—Ä–∞ (–ì–∏–¥—Ä–æ)", element: "hydro", level: 1, xp: 0, hp: 100, hpMax:100, emoji: "üíß", maxStamina:35, damage:8 }
];
let currentChar = 0;
let inventory = [];
let coins = 0;
const mapSize = 5;
let map = [];
let playerPos = { x:2, y:2 };
const enemyIcons = ["üëπ","üó°","üü¢"];
let battleEnemyHp = 30;
let battleEnemyMax = 30;
let battleStamina = 35;
let battleInProgress = false;

// === –ö–∞—Ä—Ç–∞ ===
function generateMap(){
  map=[];
  for(let y=0;y<mapSize;y++){
    let row=[];
    for(let x=0;x<mapSize;x++){
      let rand=Math.random();
      if(rand<0.15) row.push({type:"enemy", icon:enemyIcons[Math.floor(Math.random()*enemyIcons.length)], hp:30});
      else if(rand<0.15) row.push({type:"chest",icon:"üí∞"});
      else row.push("empty");
    }
    map.push(row);
  }
  playerPos={x:2,y:2};
}

function renderMap(){
  const cells=document.getElementById("map");
  cells.innerHTML="";
  for(let y=0;y<mapSize;y++){
    for(let x=0;x<mapSize;x++){
      const div=document.createElement("div");
      const cell=map[y][x];
      const isPlayer=(x===playerPos.x && y===playerPos.y);
      const type=typeof cell==="string"?cell:cell.type;
      div.classList.add("cell");
      if(type!=="empty") div.classList.add(type);
      if(isPlayer){
        div.classList.add("player");
        div.textContent=characters[currentChar].emoji;
      } else if(type==="enemy"||type==="chest") div.textContent=cell.icon;
      cells.appendChild(div);
    }
  }
  checkMapClear();
}

function checkMapClear(){
  const allEmpty = map.flat().every(c => typeof c==="string" && c==="empty");
  if(allEmpty){
    log("üó∫ –ö–∞—Ä—Ç–∞ –æ—á–∏—â–µ–Ω–∞! –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É.");
    document.getElementById("rewardMenu").classList.add("active");
  }
}

// === –í—ã–±–æ—Ä –Ω–∞–≥—Ä–∞–¥—ã ===
function chooseReward(type){
  const c = characters[currentChar];
  if(type==="stamina") c.maxStamina +=5;
  if(type==="damage") c.damage +=2;
  if(type==="hp") { c.hp +=20; c.hpMax +=20; }
  document.getElementById("rewardMenu").classList.remove("active");
  log("üéâ –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!");
  generateMap();
  renderMap();
  updateStats();
}

// === –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ ===
function move(dx,dy){
  if(battleInProgress) { log("‚öî –°–Ω–∞—á–∞–ª–∞ –∑–∞–∫–æ–Ω—á–∏—Ç–µ –±–æ–π!"); return; }
  const newX=playerPos.x+dx;
  const newY=playerPos.y+dy;
  if(newX<0||newY<0||newX>=mapSize||newY>=mapSize) return;
  const target=map[newY][newX];
  const type=typeof target==="string"?target:target.type;

  if(type==="enemy"){
    startBattle({...target});
    map[newY][newX]="empty";
  } else if(type==="chest"){
    const item="–ê—Ä—Ç–µ—Ñ–∞–∫—Ç Lv."+characters[currentChar].level;
    inventory.push(item);
    coins += 5; 
    log(`üì¶ –ù–∞–π–¥–µ–Ω —Å—É–Ω–¥—É–∫! –ü–æ–ª—É—á–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: ${item} –∏ 5üí∞`);
    map[newY][newX]="empty";
  } else log("üö∂ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ...");

  playerPos={x:newX,y:newY};
  renderMap();
  updateStats();
}

// === –ë–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ ===
function startBattle(enemy){
  document.getElementById("map").classList.remove("active");
  document.getElementById("battle").classList.add("active");
  battleEnemyMax = enemy.hp;
  battleEnemyHp = enemy.hp;
  battleStamina = characters[currentChar].maxStamina;
  updateBattleStats();
  log("‚öî –ë–∏—Ç–≤–∞ –Ω–∞—á–∞–ª–∞—Å—å!");
  battleInProgress = true;
  setTimeout(enemyTurn, 500);
}

function enemyTurn(){
  if(!battleInProgress) return;
  const dmg = Math.floor(Math.random()*10)+5;
  characters[currentChar].hp -= dmg;
  if(characters[currentChar].hp<0) characters[currentChar].hp=0;
  attackEffect("üëæ", dmg);
  updateBattleStats();
  log(`üëæ –í—Ä–∞–≥ –Ω–∞–Ω–æ—Å–∏—Ç ${dmg} —É—Ä–æ–Ω–∞!`);

  if(characters[currentChar].hp <=0){
    endBattle(false);
  } else {
    log("üó° –í–∞—à —Ö–æ–¥!");
  }
}

function playerTurn(type){
  if(!battleInProgress) return;
  const cost = type==="attack"?8:15;
  if(battleStamina < cost){
    log("‚ö° –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏!");
    return;
  }
  battleStamina -= cost;

  const dmg = type==="attack"?characters[currentChar].damage:characters[currentChar].damage*2;
  battleEnemyHp -= dmg;
  if(battleEnemyHp<0) battleEnemyHp=0;
  attackEffect(type==="attack"?"üó°":"üí•", dmg);
  log(`${type==="attack"?"üó° –ê—Ç–∞–∫–∞!":"üí• –ù–∞–≤—ã–∫!"} –ù–∞–Ω–µ—Å–µ–Ω–æ ${dmg} —É—Ä–æ–Ω–∞!`);
  updateBattleStats();

  if(battleEnemyHp <=0){
    coins += 10;
    log("üéâ –ü–æ–±–µ–¥–∞! –ü–æ–ª—É—á–µ–Ω–æ 10üí∞");
    endBattle(true);
  } else {
    setTimeout(enemyTurn, 800);
  }
}

function attackEffect(symbol,dmg){
  const eff=document.createElement("div");
  eff.className="attack-effect";
  eff.style.left=(Math.random()*200+50)+"px";
  eff.style.top=(Math.random()*200+50)+"px";
  eff.textContent=symbol+"-"+dmg;
  document.getElementById("game").appendChild(eff);
  setTimeout(()=>{eff.remove();},300);
}

function endBattle(victory){
  battleInProgress = false;
  document.getElementById("battle").classList.remove("active");
  document.getElementById("map").classList.add("active");
  if(!victory){
    log("üíÄ –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! –•–ü –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.");
    const c = characters[currentChar];
    c.hp = c.hpMax;
  }
  renderMap();
  updateStats();
}

function updateStats(){
  const c=characters[currentChar];
  document.getElementById("charName").textContent=c.name;
  document.getElementById("level").text
  Content=c.level;
  document.getElementById("xp").textContent=c.xp;
  document.getElementById("charHp").textContent=c.hp;
  document.getElementById("stamina").textContent=c.maxStamina;
  document.getElementById("coins").textContent=coins;
  document.getElementById("menuCoins").textContent=coins;
  document.getElementById("inventory").textContent=inventory.length?inventory.join(", "):"–ü—É—Å—Ç–æ";
  if(document.getElementById("battle").classList.contains("active")){
    document.getElementById("enemyHp").textContent = battleEnemyHp;
    document.getElementById("playerHp").textContent = c.hp;
    document.getElementById("battleStamina").textContent = battleStamina;
  }
}

function updateBattleStats(){
  document.getElementById("enemyHp").textContent = battleEnemyHp;
  document.getElementById("playerHp").textContent = characters[currentChar].hp;
  document.getElementById("battleStamina").textContent = battleStamina;
}

// === –ü—Ä–æ–∫–∞—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===
function toggleUpgradeMenu(){
  document.getElementById("upgradeMenu").classList.toggle("active");
}

function upgrade(type){
  if(coins<10){
    log("üí∞ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
    return;
  }
  coins-=10;
  const c = characters[currentChar];
  if(type==="stamina") c.maxStamina +=5;
  if(type==="damage") c.damage +=2;
  if(type==="hp") { c.hpMax +=20; c.hp +=20; }
  log(`‚úÖ ${type==="stamina"?"–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å":type==="damage"?"–£—Ä–æ–Ω":"–ú–∞–∫—Å –•–ü"} –ø—Ä–æ–∫–∞—á–∞–Ω!`);
  updateStats();
}

// === –°–º–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ ===
function switchCharacter(){
  currentChar=(currentChar+1)%characters.length;
  log(`üîÅ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ${characters[currentChar].name}`);
  updateStats();
  renderMap();
}

// === –õ–æ–≥ —Å–æ–æ–±—â–µ–Ω–∏–π ===
function log(msg){
  document.getElementById("log").textContent=msg;
}

// === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
generateMap();
renderMap();
updateStats();
</script>
</body>
</html>